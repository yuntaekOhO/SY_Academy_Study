package kr.s09.book;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class BookUserMain {
	
	private BufferedReader br;
	private BookDAO dao;
	//로그인시 회원번호 저장
	private int me_num;
	//로그인시 회원 메뉴가 노출
	private boolean flag;
	
	public BookUserMain() {
		dao = new BookDAO();
		try {
			br = new BufferedReader(new InputStreamReader(System.in));
			callMenu();
		}catch(IOException e) {
			e.printStackTrace();
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			if(br!=null)try {br.close();}catch(IOException e) {}
		}
	}
	
	/*
	 * menu
	 * 로그인에 성공하면
	 * 1.도서목록,2.My대출목록,3.종료 으로 바뀜
	*/
	public void callMenu() throws IOException {
		while (true) {
			// 1.로그인,2.회원가입,3.종료
			System.out.print("1.로그인,2.회원가입,3.종료>");
			try {
				int no = Integer.parseInt(br.readLine());
				if (no == 1) {// 로그인
					//로그인이 성공하면
					//me_num에 회원번호를 저장하고 flag에 true저장하고 break해서 while문 빠져나감
					System.out.print("ID:");
					String login_id = br.readLine();
					System.out.print("password:");
					String login_pw = br.readLine();
					//id,pw 검증
					me_num = dao.loginCheck(login_id, login_pw);
					if (me_num != 0) {
						System.out.println("로그인 성공!!");
						flag = true;
						break;
					}

				} else if (no == 2) {// 회원가입
					System.out.print("id:");
					String me_id = br.readLine();
					int duplicate_check = dao.checkId(me_id);
					if(duplicate_check==0) {
						System.out.print("password:");
						String me_passwd = br.readLine();
						System.out.print("이름:");
						String me_name = br.readLine();
						System.out.print("휴대폰:");
						String me_phone = br.readLine();

						dao.insertMember(me_id, me_passwd, me_name, me_phone);
					} else {
						continue;
					}
				} else if (no == 3) {// 종료
					System.out.println("프로그램 종료");
					break;
				} else {//범위 밖 입력
					System.out.println("메뉴 번호에 맞게 입력하세요.");
				}
			} catch (NumberFormatException e) {
				System.out.println("숫자만 입력하세요.");
			}
		}
		
		//로그인시 호출되는 메뉴
		while(flag) {
			//1.도서목록,2.My대출목록,3.종료
			System.out.print("["+me_num+"]"+"1.도서목록(도서대출하기),2.MY대출목록,3.종료:");
			try {
				int no = Integer.parseInt(br.readLine());
				if(no==1) {//도서목록(도서대출하기)
					
				}else if(no==2) {//my대출목록
					
				}else if(no==3) {//종료
					System.out.println("프로그램 종료.");
					break;
				}else {//범위 밖 입력
					System.out.println("메뉴 번호에 맞게 입력하세요.");
				}
			}catch(NumberFormatException e) {
				System.out.println("숫자만 입력하세요.");
			}
		}

	}
	public static void main(String[] args) {
		new BookUserMain();
	}

}
